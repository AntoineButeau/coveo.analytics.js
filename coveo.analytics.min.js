//* coveo.analytics.js 0.2.0
//* https://github.com/coveo/coveo.analytics.js
//* (c) 2015 Coveo
//* freely distributed under the MIT license
(function(){"use strict";var root=this;var doc=this.document;var isArray=Array.isArray||function(obj){return toString.call(obj)==="[object Array]"};function toobj(val){if(val==null){throw new TypeError("objectAssign cannot be called with null or undefined")}return Object(val)}var objectAssign=Object.assign||function(target,source){var from;var to=toobj(target);var assign=function(key){to[key]=from[key]};for(var s=1;s<arguments.length;s++){from=arguments[s];Object.keys(Object(from)).forEach(assign)}return target};var isMobile=function(){if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){return true}return false};var getDeviceName=function(){var userAgent=navigator.userAgent;if(userAgent.match(/Android/i)){return"Android"}if(userAgent.match(/BlackBerry/i)){return"BlackBerry"}if(userAgent.match(/iPhone/i)){return"iPhone"}if(userAgent.match(/iPad/i)){return"iPad"}if(userAgent.match(/iPod/i)){return"iPod"}if(userAgent.match(/Opera Mini/i)){return"Opera Mini"}if(userAgent.match(/IEMobile/i)){return"IE Mobile"}if(userAgent.match(/Chrome/i)){return"Chrome"}if(userAgent.match(/MSIE/i)||userAgent.match(/Trident/i)){return"IE"}if(userAgent.match(/Opera/i)){return"Opera"}if(userAgent.match(/Firefox/i)){return"Firefox"}if(userAgent.match(/Safari/i)){return"Safari"}return"Others"};var _callbackNONCE=Math.floor(Math.random()*1e3)+1;var _getCallbackNONCE=function(){return++_callbackNONCE};var _getJSONP=function(url,params,callback){if(!callback||typeof callback!=="function"){callback=function(){}}var callbackName="coveoua__"+_getCallbackNONCE();root[callbackName]=function(){callback.apply(this,arguments);delete root[callbackName]};params.callback=callbackName;var paramString=[];for(var pkey in params){if(params.hasOwnProperty(pkey)){var val=typeof params[pkey]==="string"?params[pkey]:JSON.stringify(params[pkey]);paramString.push(pkey+"="+encodeURIComponent(val))}}var scr=doc.createElement("script");scr.src=url+"?"+paramString.join("&");doc.body.appendChild(scr)};var _defaultVersion=14;var _defaultEndpoint="https://usageanalytics.coveo.com/rest/v"+_defaultVersion+"/analytics";function CoveoUA(options){if(!(this instanceof CoveoUA)){return new CoveoUA(options)}if(!options){options={}}this.version=options.version||_defaultVersion;this.endpoint=options.endpoint||_defaultEndpoint;this.token=options.token;if(!this.token){console.log("WARNING: CoveoAnalytics -> token not set ")}}CoveoUA.prototype={getStatus:function(callback){var url=this.endpoint+"/status";_getJSONP(url,{},callback)},sendSearchEvent:function(data,callback){if(!this.token){return false}var url=this.endpoint+"/search";_getJSONP(url,{searchEvent:data,access_token:this.token},callback)},sendSearchEvents:function(data,callback){if(!this.token){return false}var url=this.endpoint+"/searches";_getJSONP(url,{searchEvents:data,access_token:this.token},callback)},sendClickEvent:function(data,callback){if(!this.token){return false}var url=this.endpoint+"/click";var eventData={documentUri:data.documentUri,documentUriHash:data.documentUriHash,searchQueryUid:data.searchQueryUid,collectionName:data.collectionName||"default",sourceName:data.sourceName,documentPosition:data.documentPosition,actionCause:data.actionCause,documentTitle:data.documentTitle,documentUrl:data.documentUrl,queryPipeline:data.queryPipeline,actionType:data.actionType,anonymous:data.anonymous,userGroups:data.userGroups,userDisplayName:data.userDisplayName,customData:data.customData||{},device:data.device||getDeviceName(),mobile:data.mobile||isMobile(),splitTestRunName:data.splitTestRunName,splitTestRunVersion:data.splitTestRunVersion,userAgent:data.userAgent||navigator.userAgent,username:data.username,language:data.language||navigator.language||navigator.userLanguage};_getJSONP(url,{clickEvent:eventData,access_token:this.token},callback)},sendCustomEvent:function(data,callback){if(!this.token){return false}var url=this.endpoint+"/custom";var eventData={eventType:data.eventType,eventValue:data.eventValue,lastSearchQueryUid:data.lastSearchQueryUid,anonymous:data.anonymous,userGroups:data.userGroups,userDisplayName:data.userDisplayName,customData:data.customData||{},device:data.device||navigator.userAgent,mobile:data.mobile||isMobile(),splitTestRunName:data.splitTestRunName,splitTestRunVersion:data.splitTestRunVersion,userAgent:data.userAgent||navigator.userAgent,username:data.username,language:data.language||navigator.language||navigator.userLanguage};_getJSONP(url,{customEvent:eventData,access_token:this.token},callback)}};var _store={};var CoveoAnalytics;var simpleActions={init:function(opts){_store.ua=new CoveoUA({token:opts})},send:function(opts){var data={};if(typeof opts==="string"){data={eventType:opts}}else{data=objectAssign(data,opts)}var defaultData={eventValue:window.location.href,anonymous:true};var defaultCustomData={hostname:window.location.hostname,pathname:window.location.pathname,search:window.location.search,hash:window.location.hash,protocol:window.location.protocol,port:window.location.port,origin:window.location.origin,referrer:document.referrer,referrerHost:document.referrer.split("//").pop().split("/")[0],pageTitle:document.title};data=objectAssign({},defaultData,data);data.customData=objectAssign({},defaultCustomData,data.customData);_store.ua.sendCustomEvent(data)}};CoveoAnalytics=function(action,params){simpleActions[action](params)};CoveoAnalytics.t=1*new Date;if(root.CoveoAnalytics){CoveoAnalytics.t=root.CoveoAnalytics.t;if(isArray(root.CoveoAnalytics.q)){root.CoveoAnalytics.q.forEach(function(args){CoveoAnalytics.apply(this,args)})}}_store.t=CoveoAnalytics.t;if(typeof module!=="undefined"&&module.exports){module.exports={CoveoUA:CoveoUA,CoveoAnalytics:CoveoAnalytics}}else{root.Coveo=root.Coveo||{};root.Coveo.UA=CoveoUA;root.CoveoAnalytics=CoveoAnalytics}}).call(this);
//# sourceMappingURL=coveo.analytics.min.map
